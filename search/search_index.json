{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"capstone_stoqs","text":"<p>CSUMB Otterbots capstone project.</p> <p></p>"},{"location":"#description","title":"Description:","text":"<p>STOQS is a geospatial database and web application designed to give oceanographers efficient integrated access to in situ measurement and ex situ sample data. </p> <p>The objective of this project is to restructure the stoqs system to fit the Django-cookiecutter Template.</p>"},{"location":"#problem-statement","title":"Problem statement:","text":"<ul> <li>The current development version of STOQS is designed to run within a vagrant VM which makes it challenging to easily edit the code with a local IDE and see the changes refreshed live in the browse</li> <li>Django-cookiecutters use of docker containers sharing volumes with the local machine will hopefully make it easier for contributors to get started and make changes to STOQS</li> </ul>"},{"location":"#project-diagram","title":"Project Diagram","text":"<pre><code>flowchart LR\n    Postgis[(Postgis)]\n    Stoqs[\"Stoqs\"]\n    MapServer2[\"MapServer\"]\n    Postgis2[(Postgis)]\n    Stoqs2[\"Stoqs\"]\n    MapServer2[\"MapServer\"]\n\nsubgraph STOQS_Repo\n    subgraph Host-Machine\n        subgraph VirtualBox\n            subgraph Vagrant\n                subgraph CentOS-LinuxOS\n                    Stoqs --&gt; Postgis\n                    Stoqs --&gt; Mapserver\n                end\n            end\n        end\n    end\nend\nsubgraph Capstone_Repo\n    subgraph Host-Machine2\n        subgraph Docker-STOQS\n            Stoqs2\n        end\n        subgraph Docker-Postgis\n            Postgis2\n        end\n        subgraph Docker-Mapserver\n            MapServer2\n        end\n        Stoqs2 --&gt; Postgis2\n        Stoqs2 --&gt; MapServer2\n    end\nend\nSTOQS_Repo -- Refactor --&gt; Capstone_Repo</code></pre>"},{"location":"Debugpy/Debugpy/","title":"Running DebugPy","text":"<p>The debugger, debugpy, is implemented in a containerized Django project to enable remote debugging via Visual Studio Code (VS Code). By setting up a run configuration to attach to the Docker container and modifying the manage.py file to include debugpy, developers gain the ability to set breakpoints, inspect variables, and step through code during execution. This debugging process enhances issue identification and resolution, providing valuable insights into the application's behavior within the containerized environment.</p>"},{"location":"Debugpy/Debugpy/#to-debug-the-stoqs-application-using-debugpy-follow-these-steps","title":"To debug the Stoqs application using Debugpy, follow these steps:","text":"<p>Make sure you are in the \"capstone_stoqs/stoqs\" directory in the terminal:</p> <ol> <li>Change directory to the first \"stoqs\" directory <code>cd capstone_stoqs/stoqs</code></li> <li>In the <code>.env</code> file ensure <code>DEBUG</code> environemental variable is set to 1 </li> <li> <p>Build Containers:  <code>docker-compose -f local.yml build</code></p> </li> <li> <p>Open vscode from the stoqs directory. <code>code .</code></p> </li> </ol> <p>Note</p> <p>The top level directory in vscode needs to be <code>capstone_stoqs/stoqs</code> for debugpy to work. This is because we need to map this directory to the <code>/srv</code> directory in the container and vscode looks for the <code>.vscode/launch.json</code> file in the top level</p> <ol> <li> <p>Start container stack: <code>docker-compose -f local.yml up</code> Open Visual Studio Code (VSCode) and make sure the launch.json configuration is present.</p> </li> <li> <p>Attach the debugger in VSCode:</p> <ul> <li>Look for the \"Run and Debug\" panel in VSCode.</li> <li>Select the \"Python: Django\" configuration.</li> <li>Click the \"Start Debugging\" button.</li> <li>The application will start building, and the debugger will prompt for attachment.</li> </ul> </li> </ol> <p>Follow any further prompts during the build process, if required.</p>"},{"location":"Debugpy/Debugpy/#issues-encountered","title":"Issues Encountered:","text":"<p>Running with launch.json and Django Python: Ensure that you have the Python extension installed in VSCode and that the launch configuration points to the correct paths of your Django project and manage.py file.</p> <p>Container Compatibility: Debugging a Django application within a Docker container may sometimes reveal issues related to container compatibility and configurations. Ensure that the Docker images and containers are set up correctly, with appropriate volumes and environment variables for the debugger to function seamlessly.</p>"},{"location":"Getting-Started/Setup-and-Run/","title":"Setup and Run","text":""},{"location":"Getting-Started/Setup-and-Run/#installation-from-terminal-first-time","title":"Installation from terminal (first time)","text":"<ol> <li> <p>Clone repo (your ssh should already be setup):     <pre><code>git clone git@github.com:OtterBots/capstone_stoqs.git\n</code></pre></p> </li> <li> <p>Change directory to the stoqs project folder which contains <code>local.yml</code>:     <pre><code>cd capstone_stoqs/stoqs\n</code></pre></p> </li> <li> <p>Edit the <code>.env</code> file depending if your processor is x86 (intel/amd) or arm64 (apple silicon):     <pre><code># Library locations as provided in base image for Dockerfile-stoqs\n# This path will vary depending on your architecture use aarch64 for arm (apple silicon) and use x86 for intel/amd.\n# GEOS_LIBRARY_PATH=/usr/lib/aarch64-linux-gnu/libgeos_c.so\nGEOS_LIBRARY_PATH=/usr/lib/x86_64-linux-gnu/libgeos_c.so\n</code></pre></p> </li> <li> <p>Edit the <code>Dockerfile-mapserver</code> file located at <code>compose/local/mapserver</code> depending on whether you are x86 or arm64:     <pre><code># Change this variable based on your cpu. Use arm64 for arm (apple silscon)\nFROM mapserver/mapserver:v7.4.2\n# FROM camptocamp/mapserver:8.0-arm64\n</code></pre></p> </li> <li> <p>Edit settings in <code>.env</code> (optional) (0: off, 1: on):     <pre><code>## This variable enables debugpy listener in manage.py\nDEBUG=0\n\n## This variable forces start-stoqs.sh to run test.sh set TEST=1 to run test.sh\nTEST=0\n</code></pre></p> </li> <li> <p>Make sure your Docker Desktop program is running.  (Should be installed for your particular system.)</p> </li> <li> <p>Build project:     <pre><code>docker-compose -f local.yml build\n</code></pre></p> </li> <li> <p>Run project:     <pre><code>docker-compose -f local.yml up\n</code></pre></p> </li> <li> <p>View project in browser: <code>localhost:8000/stoqs</code></p> </li> <li> <p>To exit:     <pre><code>docker-compose -f local.yml stop\n</code></pre>     or stop containers using Docker Desktop.</p> </li> </ol> <p>Note</p> <p>All runs after only require that step 8 and onward, unless changes were made to build files or changes to .env settings.</p>"},{"location":"Getting-Started/Setup-and-Run/#troubleshooting","title":"Troubleshooting","text":"<ol> <li> <p>Windows OS pathing issues and other operating system dependant complications.</p> <p>Guide coming soon.</p> </li> <li> <p>asdf</p> <p>more stuff soon</p> </li> </ol> <p>Info</p> <p>View cookie_config.txt file for settings used in this project.</p>"},{"location":"Getting-Started/Tips/","title":"Tips","text":""},{"location":"Getting-Started/Tips/#python-debug-messsages-stoqs-container","title":"Python debug messsages (stoqs container)","text":"<p>By default print line statements in python files will not be printed to docker logs or the console. In order to get print statements for debugging purposes change we need to set the environment variable <code>PYTHONUNBUFFERED</code> to </p> <ol> <li>This can be done in the Dockerfile-stoqs. After enabling rebuild the containers with <code>docker-compose -f local.yml build</code></li> </ol> <pre><code>FROM osgeo/gdal:ubuntu-small-3.6.0\n\n# Depreciated\n# MAINTAINER Mike McCann &lt;mccann@mbari.org&gt;\n\nENV DEBIAN_FRONTEND=noninteractive\nENV PYTHONUNBUFFERED=1\n</code></pre>"},{"location":"Getting-Started/Tips/#quickly-destroy-all-containers-and-images","title":"Quickly destroy all containers and images","text":"<ul> <li>Destroy containers:</li> </ul> <pre><code>docker rm $(docker ps -a | cut -d' ' -f1 | grep -v CONTAINER | xargs) \n</code></pre> <ul> <li>Destroy images:</li> </ul> <pre><code>docker rmi $(docker images | awk {'print $3'} | grep -v IMAGE | xargs)\n</code></pre>"},{"location":"Getting-Started/Tips/#postgres-and-datagrip-or-any-data-munging-software-for-that-matter","title":"Postgres and datagrip or any data munging software for that matter","text":"<ul> <li>The port of the postgress container is exposed in the local.yml file allowing you to connect to the database from localhost:5432 to explore the db.<ul> <li>Default username and password are defined in <code>.env</code> current settings are:<ul> <li>Name: stoqsadm</li> <li>Pw:   CHANGEME</li> </ul> </li> </ul> </li> </ul> <pre><code>command: postgres -c config_file=/etc/postgresql.conf\nports:\n- \"${STOQS_PGHOST_PORT}:5432\"\n# Set user for deployment on MacOS, assign HOST_UID=&lt;result of `id -u`&gt; in your .env file\n# user: ${HOST_UID}\n</code></pre>"},{"location":"Getting-Started/env-file/","title":"Notes on the .env file","text":"<p>The <code>.env</code> file's location is: <code>/stoqs/.env</code>. This file provides all of the Docker containers with the environmental variables required for them to properly run and locate the necessary files. The <code>.env</code> file should be checked for system compatability  </p>"},{"location":"Getting-Started/env-file/#important-variables","title":"Important variables:","text":"<ul> <li><code>DEBUG</code>: This variable enables the debugpy functionality in the django. Which will pause execution each time <code>manage.py</code> is called until the vscode debuggers is connect. </li> <li>Set this variable to 1 to enable and any other value to disable</li> <li><code>TEST</code>: This variable will force the server start script to execute <code>test.sh</code> which automatically runs unit tests.</li> <li>Set this variable to 1 to enable or any other value to disable</li> <li><code>GEOS_LIBRARY_PATH</code>: This variable defines the path to <code>libgeos_c.so</code>. The path will be different depending on the host machine's cpu architecture. The proper path should be uncommented and the other commented out.</li> <li>Arm users should use <code>/usr/lib/aarch64-linux-gnu/libgeos_c.so</code></li> <li>x86 users should use <code>/usr/lib/x86_64-linux-gnu/libgeos_c.so</code></li> </ul>"},{"location":"Getting-Started/env-file/#all-variables","title":"All Variables","text":"Variable Name Description Default Note <code>DEBUG</code> Enables debugpy 0 set to 1 to enable <code>TEST</code> Forces unit test 0 set to 1 to force unit test <code>GEOS_LIBRARY_PATH</code> Path to <code>libgeos_c.so</code> /usr/lib/x86_64-linux-gnu/libgeos_c.so &lt;comment | uncomment&gt; per cpu <code>STOQS_HOME</code> Path on local machine to <code>/stoqs/</code> directory. Allows STOQS  to access files on local machine x This variable is disabled and <code>${PWD}</code> is used in the <code>local.yml</code> Windows users see Windows Setup as this will not work <code>STOQS_VOLS_DIR</code> Temporary files such as the Postgres DB will be stored here on the local machine <code>/tmp/docker_stoqs_vols</code> This may need to be cleared see Postgis Issues <code>POSTGRES_DATA</code> postgis db <code>/tmp/docker_stoqs_vols/pgdata</code> same as above <code>POSTGRES_WALDIR</code> maybe same as above? <code>/tmp/docker_stoqs_vols/pg_waldir</code> same as above? <code>PRODUCTION</code> Should specify if we want to run in production mode False Not implemented <code>DJANGO_DEBUG</code> ? False Not used. Leave false to reduce spam <code>NGINX_TMPL</code> nginx container not used nginx.tmpl unused <code>UWSGI_READ_TIMEOUT</code> server backend timeout 300 - <code>STOQS_PGHOST</code> Needed to connect to postgis stoqs-postgis just leave it as it <code>STOQS_PGHOST_PORT</code> Port postgis is listening on 5432 - <code>POSTGRES_PASSWORD</code> password to acces db changeme - <code>STOQSADM_USER</code> logs in to db during server run stoqsadm - <code>STOQSADM_PASSWORD</code> - CHANGEME - <code>MAP_SERVER_NAME</code> - localhost - <code>MAPFILE_DIR</code> - <code>/maps</code> -"},{"location":"Getting-Started/Testing/Functional-Tests/","title":"Functional Tests","text":""},{"location":"Getting-Started/Testing/Functional-Tests/#running-only-functional-tests-local-ciyml","title":"Running only functional tests (local-ci.yml)","text":"<p>In <code>.env</code> file, set <code>DEBUG=0</code> and <code>DJANGO_DEBUG=false</code>.  Stop any running containers.  This test will remove existing containers.  When the functional test is finished, you will need to re-create local.yml containers.</p> <p>Note</p> <p>This test uses Selenium, so use the following browser url: <code>http://localhost:7900/?autoconnect=1&amp;resize=scale&amp;password=secret</code>.  Selenium tests the stoqs website functionality, thus the pages will be automated.  There is no need to click anything in the browser while the test is running.</p> <ol> <li> <p>Open the terminal and go to the capstone_stoqs/stoqs directory where the local.yml is located.  Run the following command to remove all the containers:     <pre><code>docker-compose -f local.yml down\n</code></pre></p> </li> <li> <p>Build <code>local-ci.yml</code> in detached mode:</p> <pre><code>docker-compose -f local-ci.yml up -d --build\n</code></pre> </li> <li> <p>Run the <code>local-ci.yml</code>:     <pre><code>docker-compose -f local-ci.yml run --rm stoqs /bin/bash\n</code></pre></p> </li> <li> <p>After running the command, a bash shell will appear, and it will look similar to the following prompt:</p> <p><code>root@601e658963ba:/srv#</code></p> </li> <li> <p>Next, set the <code>DATABASE_SUPERUSER_URL</code> environment variable by entering the following command:     <pre><code>export DATABASE_SUPERUSER_URL=postgis://postgres:changeme@stoqs-postgis:5432/stoqs\n</code></pre></p> </li> <li> <p>Start the functional test with the following command:     <pre><code>DATABASE_URL=$DATABASE_SUPERUSER_URL python manage.py test stoqs.tests.functional_tests --settings=config.settings.ci\n</code></pre></p> </li> <li> <p>Open browser to:     <pre><code>http://localhost:7900/?autoconnect=1&amp;resize=scale&amp;password=secret\n</code></pre></p> <p>Test takes over 5 minutes.</p> </li> <li> <p>Type <code>exit</code> in shell to exit.</p> </li> <li> <p>Stop containers.     <pre><code>docker-compose -f local-ci.yml stop\n</code></pre></p> </li> <li> <p>Remove all local-ci.yml containers.     <pre><code>docker-compose -f local-ci.yml down\n</code></pre></p> </li> </ol> <p>Note</p> <p>When done with functional tests, you will need to remove the containers created by local-ci.yml (functional test containers) and re-create the local.yml development environment containers.</p>"},{"location":"Getting-Started/Testing/Functional-Tests/#troubleshooting","title":"Troubleshooting","text":""},{"location":"Getting-Started/Testing/Functional-Tests/#problem-1","title":"Problem #1:","text":"<p>The following error after step 2. <code>Error response from daemon: network 473c0b8fe4e12e0748e3ae16c565da1f05553f1188c9edac3295264961d797cd not found</code></p> <p>Solution: Do step 2 again after removing all local-ci.yml containers first: <pre><code>docker-compose -f local-ci.yml down\n</code></pre></p>"},{"location":"Getting-Started/Testing/Known-Issues/","title":"Known Issues","text":""},{"location":"Getting-Started/Testing/Known-Issues/#fail-test_parameterplot_scatter-stoqstestsunit_testssummarydatatestcase","title":"FAIL: test_parameterplot_scatter (stoqs.tests.unit_tests.SummaryDataTestCase)","text":"<p>This fail log has the following error messages associated with it:</p> <pre><code>ERROR 2023-07-31 21:18:17,343 plotting.py _make_image():654 Could not plot the data\n Traceback (most recent call last):\n   File \"/srv/stoqs/utils/Viz/plotting.py\", line 651, in _make_image\n     fig.savefig(sectionPngFileFullPath, dpi=120, transparent=True)\n   File \"/usr/local/lib/python3.10/dist-packages/matplotlib/figure.py\", line 3343, in savefig\n     self.canvas.print_figure(fname, **kwargs)\n   File \"/usr/local/lib/python3.10/dist-packages/matplotlib/backend_bases.py\", line 2366, in print_figure\n     result = print_method(\n   File \"/usr/local/lib/python3.10/dist-packages/matplotlib/backend_bases.py\", line 2232, in &lt;lambda&gt;\n     print_method = functools.wraps(meth)(lambda *args, **kwargs: meth(\n   File \"/usr/local/lib/python3.10/dist-packages/matplotlib/backends/backend_agg.py\", line 509, in print_png\n     self._print_pil(filename_or_obj, \"png\", pil_kwargs, metadata)\n   File \"/usr/local/lib/python3.10/dist-packages/matplotlib/backends/backend_agg.py\", line 458, in _print_pil\n     mpl.image.imsave(\n   File \"/usr/local/lib/python3.10/dist-packages/matplotlib/image.py\", line 1689, in imsave\n     image.save(fname, **pil_kwargs)\n   File \"/usr/local/lib/python3.10/dist-packages/PIL/Image.py\", line 2429, in save\n     fp = builtins.open(filename, \"w+b\")\n\\FileNotFoundError: [Errno 2] No such file or directory: '/srv/stoqs/media/sections/4_None_dorado_TQ20UILE31.png'\n\nERROR 2023-07-31 21:18:19,834 plotting.py _make_image():654 Could not plot the data\nTraceback (most recent call last):\n   File \"/srv/stoqs/utils/Viz/plotting.py\", line 651, in _make_image\n     fig.savefig(sectionPngFileFullPath, dpi=120, transparent=True)\n   File \"/usr/local/lib/python3.10/dist-packages/matplotlib/figure.py\", line 3343, in savefig\n     self.canvas.print_figure(fname, **kwargs)\n   File \"/usr/local/lib/python3.10/dist-packages/matplotlib/backend_bases.py\", line 2366, in print_figure\n     result = print_method(\n   File \"/usr/local/lib/python3.10/dist-packages/matplotlib/backend_bases.py\", line 2232, in &lt;lambda&gt;\n     print_method = functools.wraps(meth)(lambda *args, **kwargs: meth(\n   File \"/usr/local/lib/python3.10/dist-packages/matplotlib/backends/backend_agg.py\", line 509, in print_png\n     self._print_pil(filename_or_obj, \"png\", pil_kwargs, metadata)\n   File \"/usr/local/lib/python3.10/dist-packages/matplotlib/backends/backend_agg.py\", line 458, in _print_pil\n     mpl.image.imsave(\n   File \"/usr/local/lib/python3.10/dist-packages/matplotlib/image.py\", line 1689, in imsave\n     image.save(fname, **pil_kwargs)\n   File \"/usr/local/lib/python3.10/dist-packages/PIL/Image.py\", line 2429, in save\n     fp = builtins.open(filename, \"w+b\")\nFileNotFoundError: [Errno 2] No such file or directory: '/srv/stoqs/media/sections/1_None_dorado_CK4KDP54IS.png'\n\nERROR 2023-07-31 21:18:27,586 plotting.py _make_image():654 Could not plot the data\nTraceback (most recent call last):\n   File \"/srv/stoqs/utils/Viz/plotting.py\", line 651, in _make_image\n     fig.savefig(sectionPngFileFullPath, dpi=120, transparent=True)\n   File \"/usr/local/lib/python3.10/dist-packages/matplotlib/figure.py\", line 3343, in savefig\n     self.canvas.print_figure(fname, **kwargs)\n   File \"/usr/local/lib/python3.10/dist-packages/matplotlib/backend_bases.py\", line 2366, in print_figure\n     result = print_method(\n   File \"/usr/local/lib/python3.10/dist-packages/matplotlib/backend_bases.py\", line 2232, in &lt;lambda&gt;\n     print_method = functools.wraps(meth)(lambda *args, **kwargs: meth(\n   File \"/usr/local/lib/python3.10/dist-packages/matplotlib/backends/backend_agg.py\", line 509, in print_png\n     self._print_pil(filename_or_obj, \"png\", pil_kwargs, metadata)\n   File \"/usr/local/lib/python3.10/dist-packages/matplotlib/backends/backend_agg.py\", line 458, in _print_pil\n     mpl.image.imsave(\n   File \"/usr/local/lib/python3.10/dist-packages/matplotlib/image.py\", line 1689, in imsave\n     image.save(fname, **pil_kwargs)\n   File \"/usr/local/lib/python3.10/dist-packages/PIL/Image.py\", line 2429, in save\n     fp = builtins.open(filename, \"w+b\")\nFileNotFoundError: [Errno 2] No such file or directory: '/srv/stoqs/media/sections/19_None_M1_Mooring_70H57BIVY0.png'\n</code></pre> <p>When .env the PRODUCTION=false then that means that the following code does not execute in the compose/local/stoqs/stoqs-start.sh:</p> <pre><code>if [ \"$PRODUCTION\" == \"true\" ]; then\n   echo \"Checking for presence of ${MEDIA_ROOT}/sections...\"\n   if [[ ! -e ${MEDIA_ROOT}/sections ]]; then\n       echo \"Creating directories for image generation and serving by nginx...\"\n       mkdir -p ${MEDIA_ROOT}/sections ${MEDIA_ROOT}/parameterparameter\n       chmod 733 ${MEDIA_ROOT}/sections ${MEDIA_ROOT}/parameterparameter\n   fi\nfi\n</code></pre> <p>This means the sections folder is not created.  Although, there is also the issue of the images not being generated.</p> <p>The exact cause to why the images are not being generated has not been solved.</p>"},{"location":"Getting-Started/Testing/Known-Issues/#unit_testspy-summarydatatestcase-test_sampledparameter_select-hangs","title":"unit_tests.py: SummaryDataTestCase: test_sampledparameter_select Hangs.","text":"<p>It is unknown why this one particular test just hangs.  It was originally thought it might have been related to x3dom being down, but that may not be the case.</p>"},{"location":"Getting-Started/Testing/Known-Issues/#four-tests-that-hang-when-x3dom-is-down-or-not-responsive","title":"Four tests that hang when x3dom is down or not responsive.","text":"<p>unit_tests.py: BaseAndMeasurementViewsTestCase: test_measuredparameter</p> <p>unit_tests.py: SummaryDataTestCase: test_parameterparameterplot1</p> <p>unit_tests.py: SummaryDataTestCase: test_parameterparameterplot2</p> <p>unit_tests.py: SummaryDataTestCase: test_parameterparameterplot3</p>"},{"location":"Getting-Started/Testing/Unit-Tests/","title":"Unit Tests","text":""},{"location":"Getting-Started/Testing/Unit-Tests/#running-all-tests-testsh","title":"Running all tests (test.sh)","text":"<p>Containers should already exist for local.yml but not running before following the below instructions.  Also, <code>.env</code> file at root, set <code>DEBUG=0</code>.  This ensures no interuption from the debugpy.</p> <ol> <li> <p>Open the terminal and go to the capstone_stoqs/stoqs directory where the local.yml is located.  Run the following command to create the containers:     <pre><code>docker-compose -f local.yml run --rm stoqs /bin/bash\n</code></pre></p> </li> <li> <p>After running the command, a bash shell will appear, and it will look similar to the following prompt:</p> <p><code>root@601e658963ba:/srv#</code></p> </li> <li> <p>In the shell, enter the following command to set the <code>DATABASE_URL</code> environment variable:     <pre><code>export DATABASE_URL=postgis://stoqsadm:CHANGEME@stoqs-postgis:5432/stoqs\n</code></pre></p> </li> <li> <p>Next, set the <code>DATABASE_SUPERUSER_URL</code> environment variable by entering the following command:     <pre><code>export DATABASE_SUPERUSER_URL=postgis://postgres:changeme@stoqs-postgis:5432/stoqs\n</code></pre></p> </li> <li> <p>Now, you can run the <code>test.sh</code> script with the following command:     <pre><code>./test.sh CHANGEME load noextraload\n</code></pre></p> <p>The tests can takes over 5 minutes to complete.</p> </li> <li> <p>When finished, stop containers.</p> </li> <li> <p>Type <code>exit</code> in shell to exit.</p> </li> </ol>"},{"location":"Getting-Started/Testing/Unit-Tests/#results","title":"Results","text":"<pre><code>Unit tests...\nFound 40 test(s).\nCreating test database for alias 'default'...\nSystem check identified no issues (0 silenced).\nunit_tests.py: BaseAndMeasurementViewsTestCase: test_activity: DONE\n.unit_tests.py: BaseAndMeasurementViewsTestCase: test_activityType: DONE\n.unit_tests.py: BaseAndMeasurementViewsTestCase: test_activity_parameter: DONE\n.unit_tests.py: BaseAndMeasurementViewsTestCase: test_activity_resource: DONE\n.unit_tests.py: BaseAndMeasurementViewsTestCase: test_analysis_method: DONE\n.unit_tests.py: BaseAndMeasurementViewsTestCase: test_base_campaign: DONE\n.unit_tests.py: BaseAndMeasurementViewsTestCase: test_campaign: DONE\n.unit_tests.py: BaseAndMeasurementViewsTestCase: test_manage: DONE\n.unit_tests.py: BaseAndMeasurementViewsTestCase: test_measuredparameter_with_parametervalues: DONE\n.unit_tests.py: BaseAndMeasurementViewsTestCase: test_parameter: DONE\n.unit_tests.py: BaseAndMeasurementViewsTestCase: test_parameter_resource: DONE\n.unit_tests.py: BaseAndMeasurementViewsTestCase: test_platform: DONE\n.unit_tests.py: BaseAndMeasurementViewsTestCase: test_platformType: DONE\n.unit_tests.py: BaseAndMeasurementViewsTestCase: test_platform_resource: DONE\n.unit_tests.py: BaseAndMeasurementViewsTestCase: test_query_summary: DONE\n.unit_tests.py: BaseAndMeasurementViewsTestCase: test_query_ui: DONE\n.unit_tests.py: BaseAndMeasurementViewsTestCase: test_resource: DONE\n.unit_tests.py: BaseAndMeasurementViewsTestCase: test_resourceType: DONE\n.unit_tests.py: BaseAndMeasurementViewsTestCase: test_sample: DONE\n.unit_tests.py: BaseAndMeasurementViewsTestCase: test_sample_type: DONE\n.unit_tests.py: BugsFoundTestCase: test_activity_has_attributes: DONE\n.unit_tests.py: BugsFoundTestCase: test_lopc_data_load: DONE\n.unit_tests.py: ParquetTestCase: test_include_activity_names: DONE\nunit_tests.py: ParquetTestCase: test_include_activity_names: DONE\n.unit_tests.py: ParquetTestCase: test_multiple_activitynames: DONE\n.unit_tests.py: ParquetTestCase: test_parameter: DONE\n.unit_tests.py: ParquetTestCase: test_platform: DONE\n.unit_tests.py: ParquetTestCase: test_single_activitynames: DONE\n.unit_tests.py: SummaryDataTestCase: test_empty: DONE\n.unit_tests.py: SummaryDataTestCase: test_histograms: DONE\n.unit_tests.py: SummaryDataTestCase: test_labeled: DONE\n.unit_tests.py: SummaryDataTestCase: test_measuredparameter_select: DONE\n.unit_tests.py: SummaryDataTestCase: test_parameterplot_scatter: DONE\n.unit_tests.py: SummaryDataTestCase: test_parametervalue_min_max1: DONE\n.unit_tests.py: SummaryDataTestCase: test_platform_animations: DONE\n.unit_tests.py: SummaryDataTestCase: test_simpledepthtime_timeseries: DONE\n.unit_tests.py: SummaryDataTestCase: test_simpledepthtime_timeseriesprofile1: DONE\n.unit_tests.py: SummaryDataTestCase: test_simpledethtime_timeseriesprofile2: DONE\n.unit_tests.py: SummaryDataTestCase: test_standardname_select: DONE\n.unit_tests.py: SummaryDataTestCase: test_timedepth: DONE\n.unit_tests.py: SummaryDataTestCase: test_timedepth2: DONE\n.\n----------------------------------------------------------------------\nRan 40 tests in 706.012s\n\nOK\n</code></pre> <p>Note</p> <p>The above log was with 5 tests commented out (see Troubleshooting Problem #1).</p>"},{"location":"Getting-Started/Testing/Unit-Tests/#troubleshooting","title":"Troubleshooting","text":""},{"location":"Getting-Started/Testing/Unit-Tests/#problem-1","title":"Problem #1:","text":"<p>If running all 45 unit tests and it hangs during running test.sh, then it is possible x3dom.org is down or not working.  Or possibly a file path issue that has not been located.</p> <p>Solution: If you still want to view the results for the other tests, comment out the four below tests in test.sh:</p> <ul> <li>test_measuredparameter()</li> <li>test_parameterparameterplot1()</li> <li>test_parameterparameterplot2()</li> <li>test_parameterparameterplot3()</li> <li>test_sampledparameter_select()</li> </ul>"},{"location":"Getting-Started/Testing/Unit-Tests/#problem-2","title":"Problem #2:","text":"<p><code>stoqs.models.Parameter.DoesNotExist: Parameter matching query does not exist.</code></p> <p>Solution: Check stoqs DB and view the stoqs_parameter table.  Check if the name is in the data.  If it is not, then that is why the error happened.</p> <p>Example: <pre><code>stoqs            | ======================================================================\nstoqs            | ERROR: test_sampledparameter_select (stoqs.tests.unit_tests.SummaryDataTestCase)\nstoqs            | ----------------------------------------------------------------------\nstoqs            | Traceback (most recent call last):\nstoqs            |   File \"/srv/stoqs/tests/unit_tests.py\", line 341, in test_sampledparameter_select\nstoqs            |     CAL1939_calanoida_id = Parameter.objects.get(name='CAL1939_calanoida').id\nstoqs            |   File \"/usr/local/lib/python3.10/dist-packages/django/db/models/manager.py\", line 87, in manager_method\nstoqs            |     return getattr(self.get_queryset(), name)(*args, **kwargs)\nstoqs            |   File \"/usr/local/lib/python3.10/dist-packages/django/db/models/query.py\", line 637, in get\nstoqs            |     raise self.model.DoesNotExist(\nstoqs            | stoqs.models.Parameter.DoesNotExist: Parameter matching query does not exist.\n</code></pre> In table stoqs_parameter, the name field did not have an entry for \"CAL1939_calanoida\".</p>"},{"location":"Getting-Started/Testing/Unit-Tests/#problem-3","title":"Problem #3:","text":"<p><code>Got an error creating the test database: database \"test_stoqs\" already exists</code></p> <p><code>Type 'yes' if you would like to try deleting the test database 'test_stoqs', or 'no' to cancel:</code></p> <p>Solution: Type <code>yes</code>.  Then the test will continue.</p>"},{"location":"Known-Issues/ARM-vs-x86/","title":"ARM vs x86 Compatibility","text":""},{"location":"Known-Issues/ARM-vs-x86/#tldr","title":"TLDR","text":"<p>In the <code>.env</code> file there is a <code>SYS</code> variable defined at the top uncommenting the one which correlats to the host system architechture should bring everything up properly</p> <p>Continue readings to manually change paths</p>"},{"location":"Known-Issues/ARM-vs-x86/#mapserver","title":"MapServer","text":"<p>Currently the MapServer container is unable to start on ARM machines the only logs ouput are: <pre><code>starting fcgiwrap \nFail!\nExit code 1\n</code></pre> This is still under investigation with no path to resolution</p> <p>Potential workaround found. Found another mapserver image on dockerhub that is tagged with arm64. Comment out and uncomment the lines as necessary in <code>Dockerfile-mapserver</code></p> <pre><code>#FROM mapserver/mapserver:v7.4.2\nFROM camptocamp/mapserver:542-arm64\nUSER root\n\n# Installing the build dependencies\nRUN apt-get update -y &amp;&amp; apt-get install -y libfcgi-dev fcgiwrap nginx\n</code></pre>"},{"location":"Known-Issues/ARM-vs-x86/#stoqs","title":"STOQS","text":"<p>One of the stoqs dependencies is a package called libgeos which when installed on an arm host (Apple M1-2) will install into an <code>aarch64</code> directory as opposed to the <code>x86</code> directory when built on an x86 host. </p> <ul> <li>Refer to <code>.env</code> file. Uncomment and comment the paths based on your system</li> </ul> <pre><code># Library locations as provided in base image for Dockerfile-stoqs\nGEOS_LIBRARY_PATH=/usr/lib/x86_64-linux-gnu/libgeos_c.so\n#GEOS_LIBRARY_PATH=/usr/lib/aarch64-linux-gnu/libgeos_c.so\n</code></pre> <p>A more graceful approach to this is likely possible but for now, here we are.</p>"},{"location":"Known-Issues/Postgis-Issues/","title":"Postgis issues","text":"<ol> <li>On startup postgis displays error logs which state an invalid password, ownership issues, or non empty db <pre><code>error: directory \"/var/lib/postgresql/data/db_files\" exists but is not empty\n</code></pre></li> <li>No data is being loaded into the database on startup and there is no data currently stored in the database</li> </ol> <p>Refer to the postgis service in local.yml and the <code>${POSTGRES_DATA}</code> varbiale in the <code>.env</code> file. The Postgis container mounts the database data in a directory which is located on the local machine. As such, the data stored in it will persist through container restarts and even rebuilds. If the container is rebuilt, for some reason it occasionally loses access to db data. Additionally, If the <code>test.sh</code> script has run on the database and failed to load data, the database will have been created and subsequent container starts will not attempt to load data. </p> <ul> <li>For both of scenarios, it can be corrected by wiping out the temporary data. If your have used the default POSTGRES variables in the .env files, the temmporary data can be removed with <code>rm -rf /tmp/docker_stoqs_vols</code> This is a safe action and the containers will recreate the needed directories on next startup.</li> </ul> <p><pre><code>  postgis:\nimage: mbari/stoqs-postgis\nbuild:\ncontext: .\ndockerfile: ./compose/production/postgres/Dockerfile-postgis\nvolumes:\n- ${POSTGRES_DATA}:/var/lib/postgresql/data\n- ${POSTGRES_WALDIR}:/var/lib/postgresql/waldir\n- ./compose/production/postgres/postgres15-stoqs.conf:/etc/postgresql.conf\n</code></pre> <pre><code># POSTGRES_DATA and POSTGRES_WALDIR: Locations for the permanent database files\n# - Main data files and write ahead log variables exist for putting on separate volumes\n#   On production and development servers change to a more permanent location\nPOSTGRES_DATA=/tmp/docker_stoqs_vols/pgdata\nPOSTGRES_WALDIR=/tmp/docker_stoqs_vols/pg_waldir\n</code></pre></p>"},{"location":"Known-Issues/windows/","title":"Using Windows for Development","text":"<p>If you are using Windows as your development environment for a Docker/Django project, there are several important considerations and known issues you should be aware of. Below are some tips to help you set up and work effectively on a Windows OS.</p>"},{"location":"Known-Issues/windows/#windows-subsystem-for-linux-wsl","title":"Windows Subsystem for Linux (WSL)","text":"<p>To enhance compatibility, it's recommended to use Windows Subsystem for Linux (WSL). WSL allows you to run a Linux distribution alongside your Windows system, giving you access to native Linux tools and utilities, including Docker and Python.</p>"},{"location":"Known-Issues/windows/#setting-up-wsl","title":"Setting up WSL","text":"<p>Follow the official documentation to install and set up WSL on your Windows machine. Choose a Linux distribution, such as Ubuntu or Debian.</p>"},{"location":"Known-Issues/windows/#accessing-files","title":"Accessing Files","text":"<p>In your WSL terminal, navigate to your project using the <code>/mnt/&lt;drive letter&gt;/</code> path. For example, to access files from the <code>C:\\projects\\my-django-app</code> directory in WSL, use:</p> <pre><code>cd /mnt/c/projects/my-django-app\n</code></pre>"},{"location":"Known-Issues/windows/#end-of-line-sequences","title":"End-of-line Sequences","text":"<p>Since Windows and Linux use different end-of-line (EOL) sequences (CRLF for Windows and LF for Linux), it's essential to use consistent line endings throughout your project to avoid potential issues, especially with Docker and version control systems.</p> <p>Ensure that your code editor or IDE is set to use Unix-style line endings (LF) when working on Django and Docker files.</p>"},{"location":"Known-Issues/windows/#known-issues","title":"Known Issues","text":""},{"location":"Known-Issues/windows/#volume-mounting","title":"Volume Mounting","text":"<p>When using Docker with WSL, some issues might arise with volume mounting. Ensure that you are mounting volumes correctly to avoid file permission problems or sync issues between your Windows and WSL environments.</p>"},{"location":"Known-Issues/windows/#database-performance","title":"Database Performance","text":"<p>In some cases, database performance may suffer when running Dockerized databases on WSL due to the file system translation. Consider using a native database installation or optimizing your database configurations if you encounter performance bottlenecks.</p> <p>Please refer to the official documentation and community resources for more information on addressing these issues.</p>"}]}